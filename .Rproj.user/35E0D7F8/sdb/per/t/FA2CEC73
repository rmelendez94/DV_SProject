{
    "contents" : "# server.R\nrequire(\"jsonlite\")\nrequire(\"RCurl\")\nrequire(ggplot2)\nrequire(dplyr)\nrequire(shiny)\n\nshinyServer(function(input, output) {\n  \n  df <- data.frame(fromJSON(getURL(URLencode('skipper.cs.utexas.edu:5001/rest/native/?query=\"select * from BNKMKTG\"'),httpheader=c(DB='jdbc:oracle:thin:@sayonara.microlab.cs.utexas.edu:1521:orcl', USER='C##cs329e_rm46926', PASS='orcl_rm46926', MODE='native_mode', MODEL='model', returnDimensions = 'False', returnFor = 'JSON'), verbose = TRUE), ))\n  \n  output$scatterPlot <- renderPlot({\n    # Start your code here.\n    # Here is the scatter plot\n    if (input$OutcomeSelectionFilter == 1)\n      ofilter = 'no'\n    else if (input$OutcomeSelectionFilter == 2)\n      ofilter = 'yes'\n    else\n      ofilter = 'all'\n    \n    dfs <- df %>% select(DURATION, Y, CONS_PRICE_IDX) %>% filter(Y != ofilter)\n    \n    plot1 <- ggplot() + \n      coord_cartesian() + \n      scale_x_continuous() +\n      scale_y_continuous() +\n      labs(title='Portuguese Bank Marketing Campaign Effectiveness\\nScatter Plot') +\n      labs(x=\"Duration\", y=paste(\"Consumer Price Index\")) +\n      layer(data=dfs, \n            mapping=aes(x=as.numeric(as.character(DURATION)), y=as.numeric(as.character(CONS_PRICE_IDX)), color=Y),\n            stat=\"identity\",\n            stat_params=list(),\n            geom=\"point\",\n            geom_params=list(alpha=.8), \n            position=position_jitter(width=0, height=0)\n      ) +\n      layer(data=dfs, \n            mapping=aes(x=as.numeric(as.character(DURATION)), y=as.numeric(as.character(CONS_PRICE_IDX)), color=Y),\n            stat=\"smooth\",\n            stat_params=list(method= lm, se= FALSE),\n            geom=\"smooth\",\n            geom_params=list(alpha= .8), \n            position=position_jitter(width=0, height=0)\n        )\n    \n    # End your code here.\n    return(plot1)\n  })\n  \n  output$barPlot <- renderPlot({\n    # Start your code here.\n    # Here is the bar chart\n    \n    plottitle = \"Portuguese Bank Marketing Campaign Effectiveness\\nBar Chart:\"\n    dfb <- df %>% group_by(POUTCOME, Y) %>% summarise(AVG_CAMPAIGN = mean(CAMPAIGN))\n    if (input$ReferenceLine == 1) {\n      # Window Avg\n      subtitle = \"AVG_CAMPAIGN, WINDOW_AVG_CAMPAIGN\"\n      dfb1 <- dfb %>% ungroup %>% group_by(POUTCOME) %>% summarise(measure_value = mean(AVG_CAMPAIGN))}\n    else if (input$ReferenceLine == 2) {\n      # Window Min\n      subtitle = \"AVG_CAMPAIGN, WINDOW_MIN_CAMPAIGN\"\n      dfb1 <- dfb %>% ungroup %>% group_by(POUTCOME) %>% summarise(measure_value = min(AVG_CAMPAIGN))}\n    else if (input$ReferenceLine == 3) {\n      # Window Max\n      subtitle = \"AVG_CAMPAIGN, WINDOW_MAX_CAMPAIGN\"\n      dfb1 <- dfb %>% ungroup %>% group_by(POUTCOME) %>% summarise(measure_value = max(AVG_CAMPAIGN))}\n    else {\n      # Window Sum\n      subtitle = \"AVG_CAMPAIGN, WINDOW_SUM_CAMPAIGN\"\n      dfb1 <- dfb %>% ungroup %>% group_by(POUTCOME) %>% summarise(measure_value = sum(AVG_CAMPAIGN))}\n    dfb <- inner_join(dfb, dfb1, by=\"POUTCOME\")\n    \n    #spread(dfb, Y, AVG_CAMPAIGN) %>% View\n    \n    plot2 <- ggplot() + \n      coord_cartesian() + \n      scale_x_discrete() +\n      scale_y_continuous() +\n      facet_wrap(~POUTCOME, ncol=1) +\n      labs(title=paste(plottitle,subtitle,sep = \" \")) +\n      labs(x=paste(\"Y (OUTCOME)\"), y=paste(\"AVG_CAMPAIGN\")) +\n      layer(data=dfb, \n            mapping=aes(x=Y, y=AVG_CAMPAIGN, color=Y, fill=Y), \n            stat=\"identity\", \n            stat_params=list(), \n            geom=\"bar\",\n            geom_params=list(width=.25), \n            position=position_identity()\n      ) + coord_flip() +\n      layer(data=dfb, \n            mapping=aes(x=Y, y=measure_value, label=round(measure_value, 4)), \n            stat=\"identity\", \n            stat_params=list(), \n            geom=\"text\",\n            geom_params=list(colour=\"black\", hjust=1.5, size=3.5), \n            position=position_identity()\n      ) +\n      layer(data=dfb, \n            mapping=aes(yintercept = measure_value), \n            geom=\"hline\",\n            geom_params=list(colour=\"red\")\n      ) \n    \n    \n    # End your code here.\n    return(plot2)\n  })\n\n  output$crosstabPlot <- renderPlot({\n# Start your code here.\n\n# Here is the Crosstab and KPI\n    \nKPI_Low_Max_value = input$KPI1     \nKPI_Medium_Max_value = input$KPI2\n    \n#df %>% group_by(JOB) %>% summarize() %>% View()\n\ndfc <- df %>% mutate(Yyes = ifelse(Y == 'yes', 1, 0), Yno = ifelse(Y == 'no', 1, 0)) %>% group_by(EDUCATION) %>% mutate(Ratio = sum(Yyes)/sum(Yno)) %>% ungroup() %>% group_by(EDUCATION, Y, HOUSING) %>% summarize(AVG_DURATION = round(mean(DURATION),1), Ratio = mean(Ratio)) %>% mutate(KPI = ifelse(Ratio <= KPI_Low_Max_value, '03 Low', ifelse(Ratio <= KPI_Medium_Max_value, '02 Medium', '01 High')))\n\n#spread(dfc, Y, AVG_DURATION) %>% View\n\ndfc$EDUCATION <- factor(dfc$EDUCATION, levels = c(\"illiterate\", \"basic4y\", \"basic6y\", \"basic9y\", \"highschool\", \"universitydegree\", \"professionalcourse\", \"unknown\"))\n    \nplot3 <- ggplot() + \n  coord_cartesian() + \n  scale_x_discrete() +\n  scale_y_discrete() +\n  scale_fill_manual(values = c(\"green\",\"yellow\",\"red\")) + \n  facet_grid(.~EDUCATION) + \n  labs(title='Portuguese Bank Marketing Campaign Effectiveness\\nCrosstab\\nAVG_DURATION') +\n  labs(x=paste(\"EDUCATION/Y\"), y=paste(\"HOUSING\")) +\n  layer(data=dfc, \n        mapping=aes(x=Y, y=HOUSING, label=AVG_DURATION), \n        stat=\"identity\", \n        stat_params=list(), \n        geom=\"text\",\n        geom_params=list(colour=\"black\", size=2.8), \n        position=position_identity()\n  ) +\n  layer(data=dfc, \n        mapping=aes(x=Y, y=HOUSING, fill=KPI), \n        stat=\"identity\", \n        stat_params=list(), \n        geom=\"tile\",\n        geom_params=list(alpha=0.50), \n        position=position_identity()\n  )\n\n# End your code here.\n      return(plot3)\n  })\n})\n",
    "created" : 1447883384562.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3230297231",
    "id" : "FA2CEC73",
    "lastKnownWriteTime" : 1447889515,
    "path" : "~/Desktop/Desktop/UT/Fall 2015/Data Visualization/DV_SProject/02 Shiny/server.R",
    "project_path" : "02 Shiny/server.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}